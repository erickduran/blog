---
layout: post
title: 'Keeping my plants alive from overseas'
tags: [Python, Raspberry Pi, Gardening, Home Lab]
category: Programming
comments: true
---

During the last months I've been getting into amateur gardening and, as a fan of automation, I've come to set up an almost fully-automated home garden using Python, Raspberry Pi and Telegram.

Here's my setup:

##

## Summary

So, it all starts with my main RPi. This RPi runs a Telegram "bot" using Telethon (not actually a *bot* as commonly known in Telegram, it's basically a normal chat), which listens to any commands sent by my Telegram user to the RPi's Telegram user. 

Commands work as any other CLI, you have commands and subcommands, and you start by specifying the RPi you want to target (I have 5, so each one has an alias). We will only work with my main RPi, as this is the one that can actually trigger the garden's circuit.

So we sent the message:
```
pi-name water plant-name
```

The `water` command has a mapping that translates plant names into GPIO ports. Using a 16-channel relay, each GPIO port toggles the corresponding water pump that has a tube pointing to the appropriate plant. The mapping also contains a default duration for the pump to be running, depending on how much water the specific plant needs.

> How much water is sent (or for how many seconds the pump is turned on) is calibrated by trial and error since there are many factors involved (I've been using pumps from different manufacturers, different tube lengths and heights for the pots).

And that's basically it, that's the "manual" process.

### Automation

The garden command can also be triggered using a script, so it's trivial to set up a schedule to 

```
15 8 */2 * * python3 /home/momo/pi-utils/scripts/garden.py pepper
17 8 */2 * * python3 /home/momo/pi-utils/scripts/garden.py basil
19 8 */2 * * python3 /home/momo/pi-utils/scripts/garden.py mint
...
```

> Note there is a 2 minute different between each run, as I've not set up any concurrency.

Even though it's great to have it running all by itself, I actually prefer to run it using the Telegram chat.

## Redundancy

## Incident response & other stuff

## CI/CD and update workflow
I host the scripts in GitHub, and each RPi
